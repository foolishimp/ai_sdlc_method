# ADR-GC-003: Firestore for Event Sourcing and State

**Status**: Accepted
**Date**: 2026-02-23
**Deciders**: Gemini Cloud Genesis Design Authors
**Requirements**: REQ-FEAT-001, REQ-FEAT-002, REQ-COORD-001
**Extends**: ADR-GC-001 (Vertex AI Platform)

---

## Context

The methodology uses event sourcing (`events.jsonl`) as the formal execution model. In a cloud environment, we need a database that supports: (1) high-frequency append-only writes, (2) document storage for feature vectors, (3) real-time notifications for local tool syncing, and (4) atomic transactions for multi-agent claim coordination.

### Options Considered

1. **Cloud SQL**: Relational consistency but higher cost and less flexible for varying event schemas.
2. **BigQuery**: Great for telemetry, but not suited for real-time feature vector state or small transactional claims.
3. **Firestore (The Decision)**: Document-oriented, scalable, supports real-time listeners and atomic transactions.

---

## Decision

**We use Google Cloud Firestore as the canonical event store and feature vector state database.**

Implementation details:
- **`events` collection**: Each iterate turn appends a new document. Firestore streams can trigger secondary projections (e.g., updating STATUS.md summary).
- **`features` collection**: Stores the current state of each feature vector. Local CLI tools use Firestore "Snapshots" or listeners to keep local views fresh.
- **`claims` collection**: Uses Firestore Transactions to ensure exactly-one-writer for a specific feature/edge combination.

---

## Rationale

### Synergy with CLI Tools
Firestore’s ability to "push" updates to clients (even CLI ones) is a significant advantage. It allows the Gemini Cloud CLI to react instantly to events generated by background sensory services or CI/CD pipelines without polling.

---

## Consequences

### Positive
- **Real-time Sync**: Local and cloud state stay in lockstep natively.
- **Schema Flexibility**: Different event types can have varying structures without table migrations.
- **ACID Transactions**: Reliable multi-agent coordination.

### Negative
- **No SQL Joins**: Complex aggregated views (like Gantt data) must be pre-computed or projected into separate documents.

---

## References

- [GEMINI_CLOUD_GENESIS_DESIGN.md](../GEMINI_CLOUD_GENESIS_DESIGN.md)
- [ADR-AB-005](../adrs/ADR-AB-005-event-sourcing-dynamodb.md) — AWS DynamoDB equivalent
